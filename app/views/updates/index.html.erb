<h1>Live Updates</h1>

<!DOCTYPE html>
<html>
  <head>
    <script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyA9JBz-80iyKF7JGzeikG0zHHqWdF2CLPs&sensor=true">
    </script>
    <script type="text/javascript"
  src="http://maps.googleapis.com/maps/api/js?libraries=visualization&sensor=true"></script>


     <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>


  <script>

    if (navigator.geolocation) {
      var timeoutVal = 10 * 1000 * 1000;
      navigator.geolocation.getCurrentPosition(
        displayPosition,
        displayError,
        { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
      );
    }
    else{
      alert("Geolocation is not supported by this browser");
    }
    function displayPosition(position) {
      var pos = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
      var options = {
        zoom: 16,
        center: pos,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      };
      var map = new google.maps.Map(document.getElementById("googleMap"), options);
      var marker = new google.maps.Marker({
        position: pos,
        map: map,
        title: "Current Location"
      });
      var contentString = "<br/><b>Current location:</b> lat " + position.coords.latitude + ", long " + position.coords.longitude;
      var infowindow = new google.maps.InfoWindow({
        content: contentString
      });
      google.maps.event.addListener(marker, 'click', function() {
        infowindow.open(map,marker);
      });

      var heatmapData = generateRandomData();
       var heatmap = new google.maps.visualization.HeatmapLayer({
        data: heatmapData
      });
      heatmap.setMap(map);
    }
    function displayError(error) {
      var errors = {
        1: 'Permission denied',
        2: 'Position unavailable',
        3: 'Request timeout'
      };
      alert("Error: " + errors[error.code]);
    }


    function getRandomInRange(from, to, fixed) {
      return (Math.random() * (to - from) + from).toFixed(fixed) * 1;
    }
    function generateRandomData() {
      var heatData = new Array(100000);
      for (var i = 0; i < heatData.length; i++){
        lat = getRandomInRange(43.645527, 43.660527, 4);
        lon = getRandomInRange(-79.390961, -79.372961, 4);
        heatData[i] = new google.maps.LatLng(lat,lon);
      }
      return heatData;
    }

  </script>
  </head>

  <body>
    <div id="googleMap" style="width:500px;height:380px;"></div>
    <%= render 'displayUpdates' %>

    <% if logged_in? %>
          <%= link_to 'Post Update', new_update_path, class: 'btn' %>
    <% else %>
          <%= link_to 'Sign In to Update', new_session_path, class: 'btn' %>
    <% end %>


  </body>
</html>
